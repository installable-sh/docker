#!/bin/sh
# Pre-commit hook: format and lint staged Go files

# Get list of staged .go files
STAGED_GO_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.go$')

if [ -z "$STAGED_GO_FILES" ]; then
    exit 0
fi

# Format staged files
echo "Formatting Go files..."
for file in $STAGED_GO_FILES; do
    gofmt -s -w "$file"
    git add "$file"
done

# Run linter if available
if command -v golangci-lint >/dev/null 2>&1; then
    echo "Running linter..."
    golangci-lint run --new-from-rev=HEAD~1 || exit 1
fi

exit 0
